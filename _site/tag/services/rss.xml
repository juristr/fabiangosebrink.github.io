<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>http://fabian-gosebrink.com</title>
   
   <link>http://offering.solutions</link>
   <description>Articles about Angular & ASP.NET</description>
   <language>en-us</language>
   <managingEditor> Fabian Gosebrink</managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>Clean your viewmodel in WPF and create a facade</title>
	  <link>//blog/articles/2014/07/03/clean-your-viewmodel-in-wpf-and-create-a-facade/</link>
	  <author>Fabian Gosebrink</author>
	  <pubDate>2014-07-03T17:51:00+02:00</pubDate>
	  <guid>//blog/articles/2014/07/03/clean-your-viewmodel-in-wpf-and-create-a-facade/</guid>
	  <description><![CDATA[
	     <p>In this post I want to show you how to Clean your viewmodel in WPF and create a facade.</p>

<p>We use a facade to get your viewmodel in WPF nice and clean. I want to show you how to get along with the seperation of concerns and how to write simple and testable code with databinding and WPF.</p>

<p>When you want to use a viewmodel for databinding you normally get your public properties on your viewmodel an do a normal binding on your xaml like this:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Window</span> <span class="na">x:Class=</span><span class="s">"WPFViewModelAsFacade.MainWindow"</span>
        <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="na">Title=</span><span class="s">"MainWindow"</span> <span class="na">Height=</span><span class="s">"350"</span> <span class="na">Width=</span><span class="s">"525"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Grid&gt;</span>
        <span class="nt">&lt;TextBlock</span> <span class="na">Text=</span><span class="s">"{Binding MyCalculatedNumber}"</span><span class="nt">&gt;&lt;/TextBlock&gt;</span>
    <span class="nt">&lt;/Grid&gt;</span>
<span class="nt">&lt;/Window&gt;</span></code></pre></figure>

<p>Setting the datacontext:</p>

<figure class="highlight"><pre><code class="language-cs" data-lang="cs"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="n">DataContext</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MainViewModel</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure>

<p>and your viewmodel something like:</p>

<figure class="highlight"><pre><code class="language-cs" data-lang="cs"><span class="k">public</span> <span class="k">class</span> <span class="nc">MainViewModel</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">_myCalculatedNumber</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">MyCalculatedNumber</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_myCalculatedNumber</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">set</span> <span class="p">{</span> <span class="n">_myCalculatedNumber</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//other Properties here...
</span>
        <span class="k">public</span> <span class="nf">MainViewModel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_myCalculatedNumber</span> <span class="p">=</span> <span class="m">23</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure>

<p>of course you would give the viewmodel other values and it would grow like hell. Also when you do calculations or CRUD-operations etc. But when your application grows and gets bigger it would be necessary to move some thing into services, providers etc. to get into the seperation of concerns.</p>

<h3 id="solution-i---services">Solution I -  Services</h3>

<p>So lets introduce a service to do some work (a normal calculation with the result of 23 in my example):</p>

<p><img src="/assets/articles/2014-07-03/1.jpg" alt="clean your viewmodel in WPF and create a facade" /></p>

<figure class="highlight"><pre><code class="language-cs" data-lang="cs"><span class="k">namespace</span> <span class="nn">WPFViewModelAsFacade</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="n">ICalculationService</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="nf">CalculateNumber</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-cs" data-lang="cs"><span class="k">namespace</span> <span class="nn">WPFViewModelAsFacade</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CalculationService</span> <span class="p">:</span> <span class="n">ICalculationService</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="nf">CalculateNumber</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//do some calculation/work
</span>            <span class="c1">//return result...
</span>            <span class="k">return</span> <span class="m">23</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And your viewmodel could look like this</p>

<figure class="highlight"><pre><code class="language-cs" data-lang="cs"><span class="k">namespace</span> <span class="nn">WPFViewModelAsFacade</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MainViewModel</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">_myCalculatedNumber</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">MyCalculatedNumber</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_myCalculatedNumber</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">set</span> <span class="p">{</span> <span class="n">_myCalculatedNumber</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//other Properties here...
</span>
        <span class="k">public</span> <span class="nf">MainViewModel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">ICalculationService</span> <span class="n">calculationService</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CalculationService</span><span class="p">();</span>
            <span class="n">_myCalculatedNumber</span> <span class="p">=</span> <span class="n">calculationService</span><span class="p">.</span><span class="nf">CalculateNumber</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p><span style="color: #999999;">Note: Normally you would use dependency injection here to avoid this “new …” call and a link to the direct implementation of the service.</span></p>

<p>So: Now we have outsourced the calculation and introduced a new service which is doing the work. But this is not a facade. Our viewmodel is still very big (image it bigger than it looks here: There are a lot more properties on it in a real application).</p>

<h3 id="solution-ii---facade">Solution II - Facade</h3>

<p>The viewmodel should now get a real facade and only offer the service which is doing the calculation. This makes you more flexible and the viewmodel is like only an interface for the view. Its like a provider for every service (or providers) which contain the information the view needs.</p>

<figure class="highlight"><pre><code class="language-cs" data-lang="cs"><span class="k">namespace</span> <span class="nn">WPFViewModelAsFacade</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="n">ICalculationService</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">CalculatedNumber</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-cs" data-lang="cs"><span class="k">namespace</span> <span class="nn">WPFViewModelAsFacade</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CalculationService</span> <span class="p">:</span> <span class="n">ICalculationService</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">CalculatedNumber</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="nf">CalculationService</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Do some stuff here and get the result in the defined property
</span>            <span class="n">CalculatedNumber</span> <span class="p">=</span> <span class="m">25</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-cs" data-lang="cs"><span class="k">public</span> <span class="k">class</span> <span class="nc">MainViewModel</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">ICalculationService</span> <span class="n">_calculationService</span><span class="p">;</span>
    <span class="c1">//other Properties here...
</span>
    <span class="k">public</span> <span class="n">ICalculationService</span> <span class="n">CalculationService</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_calculationService</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">MainViewModel</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_calculationService</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CalculationService</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>So far until here. What we did is: We are only offering the service through our viewmodel and our viewmodel is not interested in what happens behind anymore. The service can do his work and only give back his results. But you have to correct you binding now because your number is not in the viewmodel anymore but in the service behind.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Window</span> <span class="na">x:Class=</span><span class="s">"WPFViewModelAsFacade.MainWindow"</span>
        <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="na">Title=</span><span class="s">"MainWindow"</span> <span class="na">Height=</span><span class="s">"350"</span> <span class="na">Width=</span><span class="s">"525"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Grid&gt;</span>
        <span class="nt">&lt;TextBlock</span> <span class="na">Text=</span><span class="s">"{Binding CalculationService.CalculatedNumber}"</span><span class="nt">&gt;&lt;/TextBlock&gt;</span>
    <span class="nt">&lt;/Grid&gt;</span>
<span class="nt">&lt;/Window&gt;</span></code></pre></figure>

<p>We are now bind on our service “.” our property. Its the same with Commands. Commands should be seperate classes (in a seperated namespace) and you be offered through the viewmodel.</p>

<p>If you do this your viewmodel gets a complete facade and you can change the services underneath without touching the viewmodel. So every testcase you write for the viewmodel would be untouched :)</p>

<p>Note: Your viewmodel does not have to implement INotifypropertyChanged then. If you make classes/interfaces which are providing informations to the UI these classes are the only ones who have to implement INotifyPropertyChanged.</p>

<p>If you think further it would be better to seperate the service one again and getting a provider between the service, which is doing the real job and the class/interface, which is giving the data to the outside world. This provider (or however you call it) can then be offered in the viewmodel and you would bind first over this one. But for now this should be it, I think you got my point ;) .</p>

<p><img src="/assets/articles/2014-07-03/2.jpg" alt="clean your viewmodel in WPF and create a facade" />
<img src="/assets/articles/2014-07-03/Facade.jpg" alt="clean your viewmodel in WPF and create a facade" /></p>

<p><a href="/assets/articles/2014-07-03/WPFViewModelAsFacade.zip">WPFViewModelAsFacade Solution</a></p>

	  ]]></description>
	</item>

	<item>
	  <title>Structurize your project with areas and services in ASP.NET MVC</title>
	  <link>//blog/articles/2014/06/01/structurize-your-project-with-areas-and-services-in-asp-net-mvc/</link>
	  <author>Fabian Gosebrink</author>
	  <pubDate>2014-06-01T08:39:56+02:00</pubDate>
	  <guid>//blog/articles/2014/06/01/structurize-your-project-with-areas-and-services-in-asp-net-mvc/</guid>
	  <description><![CDATA[
	     <p>In this blogpost I want to show you one possible way to structurize your project with areas and services in ASP.NET MVC.</p>

<p>This is the first part of several architecture posts I will publish in the next time.</p>

<p>The idea to this came up because I noticed that if you are implementing ASP.NET mvc-code you always come to a point where you have to invest some time in the architecture. With a growing project it’s always good to keep an overview of who is doing what, when and where. Also the first question after implementing your first mvc-project lines of code is exactly the participation of the different concerns, which means: How to give your project a structure.</p>

<p>After some tries I came up with a solution of using some patterns and stuff. So this is the first post of two (or three) where I want to give you an idea how to get along with the problems giving your solution a system.</p>

<p><strong>1)     </strong> <strong>Viewmodels and Submitmodels</strong></p>

<p>I don’t want to get into this further because I already did a blog post on this (<a href="http://blog.noser.com/why-and-how-to-avoid-viewbag-and-viewdata-in-asp-net-mvc/" target="_blank">here </a>and <a href="http://blog.noser.com/what-are-submitmodels-and-how-to-use-them/" target="_blank">here</a>). You can see an example of how to get along with viewmodels and submitmodels.</p>

<p>VMs and SMs are one essential part (of many 😉 ) of your mvc-application. They give you more control and they help you to figure out what’s going on. Not only in case of an error.</p>

<p><strong>2)     </strong> <strong>Areas</strong></p>

<p>Do work with areas. Ever. I know in the beginning it seems useless to you because you “just want to get a little thing done”. But do use areas (and thank me later). This is the second step of getting structure into your project from the beginning.</p>

<p><span style="color: #808080;">When I started to do this I got problems sharing my partial views from the top-level “Shared”-Folder which is given to me from the MVC-Template.</span></p>

<p><span style="color: #808080;"><a href="http://brockallen.com/2012/08/31/sharing-a-single-_viewstart-across-areas-in-asp-net-mvc/"><span style="color: #808080;">http://brockallen.com/2012/08/31/sharing-a-single-_viewstart-across-areas-in-asp-net-mvc/</span></a></span></p>

<p><span style="color: #808080;">Has a solution for this. So this should not be a problem for you anymore.</span></p>

<p>Areas are adding a separate “room” for a special part of your website with its own controller, models and views.</p>

<p><img src="/assets/articles/2014-06-01/518fb795-0f60-47a8-8312-5edebe28335b.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>Note: You can of course add areas and name them as you want. But I think it’s always good to have a first point where the user first “sees” your application. So remind to have an Area which is giving you this information on the first sight. So name it like “Home” (which is standard). But also “Start” or anything like this would be okay.</p>

<p><strong>3)     </strong> <strong>Area-Models</strong></p>

<p>So we see that an area is giving your project more structure, also you are summarizing the possibilities and “rooms” of your application and of what it is able to do.</p>

<p>In point 1 I mentioned the view- and submitmodels you have to give your view the information it needs.</p>

<p>You can lay them down in the models-folder. But do not do this on the top-level. Well, you can do this. But I am a fan of namespaces. So I do add a folder for each action I have in the controller (if they have own view-and submitmodels) and add them into this folder.</p>

<p><img src="/assets/articles/2014-06-01/357eb813-fd76-41dd-b9c6-8bfeaa25ccae.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>In this screenshot you see an area called “Projects” because it’s only handling everything which is connected to a project-object which can be handled in this web-application. For every action I added a namespace. In this namespace every single viewmodel and submitmodel can be found.</p>

<p>So you are hiding all information here for someone who is looking at your solution. Only if he is really interested in the code of your models he has to open one. If not he gets a perfect overview of what you can do with your project-object in your web-application without getting into the code of the controller. (Imagine here that this “someone” could be you looking into your code after some time. You will be thankful to have a good structure).</p>

<p><em>Conclusion so far: Keep your models in the given “models”-folder the area is offering to you. Do add namespaces to actions you can to and summarize all view- and submitmodels in these folders. This gets a perfect overview of what your controller offers and you can find immediately what you are searching for, if you are searching for it. And *only* this. Nothing confusing.</em></p>

<p><strong>4)     </strong> <strong>Area-Views</strong></p>

<p>If you added the folders like mentioned in the point before you should also have the views folder looking like the folder structure of your “models”-Folder</p>

<p><img src="/assets/articles/2014-06-01/35e36f7e-028e-49fd-845a-4ff70ac5147f.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>This is good so far. Nothing confusing and everybody gets the idea of what is offered here. Every view has exactly the name of what it offers to the user. Here nothing has to be done so far. Looks clean and nice.</p>

<p><img src="/assets/articles/2014-06-01/309ab2b9-f3df-4258-9557-b0ce87e33335.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>Here you can see again the clean folder structure which fits perfectly to the views. For each view you or someone else finds the information immediately. And it presents the fact, that every viewmodels is connected to a view.</p>

<p><em>Conclusion so far: We have now a clean models-folder and views which represent the models and the functionality of the application in this area part. You know the connections between them because of a clean naming and concern-separation.But their relations is also clear because of a clean naming.</em></p>

<p>So now we have touched areas, views and models inside an area. Okay…the controller is missing. But before I go into this I have to get a step back:</p>

<p><strong>5)     </strong> <strong>Controller Services and the controller</strong></p>

<p>We know that the controller receives the requests from your client and handles them. But I was never happy with this many lines of code in my controller. What I mean: He is the interface for your requests, he receives them. He is also responsible for giving the client back what he deserves. And that should be all. All the logic in between should not be into the controller, so why do not separate it and let the controller do what he is made for?</p>

<p>That is why I am using Services inside areas. Such a service works really near the area and has an interface, which is only providing all the methods the controller needs. Nothing more and nothing less. This service also knows view- and submitmodels. This is why the folder is placed beside the models-Folder.</p>

<p><img src="/assets/articles/2014-06-01/f68f4fa0-7922-4196-9d8f-e9d3105145a5.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>Here on the first sight you only have the interface of the controller service without seeing the real implementation on it. The service is offering everything to the controller what the controller really needs.</p>

<p>Example:</p>

<p>Controller Code:</p>

<p><img src="/assets/articles/2014-06-01/089027b4-b577-4ae8-853c-accc685f102d.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>Service-Interface:</p>

<p><img src="/assets/articles/2014-06-01/f83d4d16-84bc-48a4-8528-d597b7b0672a.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>Here you see that in the controller you have only one call to the service which is doing all the work for you. So the controller has only to get the requests, call the method and gives back the result. He does not care about what is in your viewmodel (like errormessages, sucessmessages, etc.)</p>

<p><span style="color: #808080;">As I said: I am a fan of namespaces, so I encapsulate the implementation in a namespace (“Impl”), separating it from the interface (because the interface is the first thing that interests me when I am looking at code. “What does the service give me?” comes before “How does he do it?”).</span></p>

<p>So here the real work is done. Here my UnitOfWork is used (which I inject once per Request, so every request gets one UnitOfwork. Ninject has this feature for you: RequestScope ;))</p>

<p>If you look at the code, you see the next thing I am doing to get a separation of concerns: Factories!</p>

<p><strong>6)     </strong> <strong>Factories</strong></p>

<p>Every(!) viewmodel gets a factory which gets the viewmodel everything it needs. This is why I have another folder in my service-namespace called “Factories”. I hide this information inside the service namespace because the factories are only used inside this service and nowhere else.</p>

<p><img src="/assets/articles/2014-06-01/375c85e6-9c17-4768-ba88-28bb635cd7b5.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>All the factories are getting injected everything they need to build up the requested viewmodel and every viewmodel has its own factory. So you can test the viewmodels perfectly and one is not related to the other.</p>

<p><span style="color: #808080;">I won’t get in detail HOW exactly to create viewmodels, because this really depends on what you want to show in your view.</span></p>

<p>To summarize, this is how an area could look like:</p>

<p><img src="/assets/articles/2014-06-01/6fdc0f3b-9843-49f2-8060-dabef9f4e150.png" alt="Structurize your project with areas and services in ASP.NET MVC" /></p>

<p>You have your view which is presenting everything it needs from the viewmodel, which is stored in the models-namespace. The controller has only a minimum of logic in it: Getting requests, calling his service and giving the result back. The controller service is handling everything for the controller by using factories to create viewmodels etc.</p>

<p>Your separation of concerns is fulfilled, you can apply this “template” on every area you build and you are working with clean view, and submitmodels which I mentioned earlier in this post.</p>

<p>In the next blog post I will present you the sense of Area-Services and Business-services and why I separate them explicitly. After this I will present you the Generic UnitOfWork-Pattern to get your repositories on a clean way.</p>

<p>Thanks for reading.</p>

<p>Regards</p>

<p>Fabian</p>

	  ]]></description>
	</item>


</channel>
</rss>
