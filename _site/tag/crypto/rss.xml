<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>http://fabian-gosebrink.com</title>
   
   <link>http://offering.solutions</link>
   <description>Articles about Angular & ASP.NET</description>
   <language>en-us</language>
   <managingEditor> Fabian Gosebrink</managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>Using the Crypto-Namespace to Generate Salts and Compare Passwords</title>
	  <link>//blog/articles/2014/03/03/using-crypto-namespace-to-generate-salts-and-compare-passwords/</link>
	  <author>Fabian Gosebrink</author>
	  <pubDate>2014-03-03T22:02:40+01:00</pubDate>
	  <guid>//blog/articles/2014/03/03/using-crypto-namespace-to-generate-salts-and-compare-passwords/</guid>
	  <description><![CDATA[
	     <p>In this blogpost I want to show how to use the Crypto-Namespace to Generate Salts and Compare Passwords</p>

<p><a href="https://msdn.microsoft.com/en-us/library/system.web.helpers.crypto.hashpassword(v=vs.111).aspx" target="_blank">Crypto.HashPassword Method</a></p>

<h4>Using Crypto Namespace to Generate Salts and Compare Passwords</h4>

<p>If you are implementing a custom membership- and/or roleprovider (I wont go into custom providers because beside pictures of cats (with or without money or guns) and porn this is one of the most mentioned topics in the web) you should always store passwords with a salt.</p>

<p>With the crypted password and the salt you can compare the values during the login-process and set it during the registration process easily by using the Crypto-Namespace of ASP.NET.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="kt">bool</span> <span class="nf">RegisterUser</span><span class="p">(</span><span class="kt">string</span> <span class="n">username</span><span class="p">,</span> <span class="kt">string</span> <span class="n">password</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">loginImmediately</span><span class="p">,</span> <span class="kt">string</span> <span class="n">role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">UserExists</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">MembershipCreateUserException</span><span class="p">(</span><span class="n">MembershipCreateStatus</span><span class="p">.</span><span class="n">DuplicateUserName</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="n">User</span> <span class="n">user</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">User</span><span class="p">();</span>
    <span class="n">user</span><span class="p">.</span><span class="n">Username</span> <span class="p">=</span> <span class="n">username</span><span class="p">;</span>
    <span class="n">user</span><span class="p">.</span><span class="n">Password</span> <span class="p">=</span> <span class="n">password</span><span class="p">;</span>
    <span class="n">user</span><span class="p">.</span><span class="n">PasswordSalt</span> <span class="p">=</span> <span class="n">Crypto</span><span class="p">.</span><span class="nf">GenerateSalt</span><span class="p">();</span>
    <span class="n">user</span><span class="p">.</span><span class="n">Password</span> <span class="p">=</span> <span class="n">Crypto</span><span class="p">.</span><span class="nf">HashPassword</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"{0}{1}"</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">Password</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">PasswordSalt</span><span class="p">));</span>

    <span class="c1">// Add Role and insert User into DB
</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">loginImmediately</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">WebSecurity</span><span class="p">.</span><span class="nf">Login</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">Username</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span> 
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">registeredSuccessfully</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>The <code class="highlighter-rouge">Crypto.GenerateSalt()</code>-Method automatically creates a random salt-value which can be used to hash the password with. This hashed (!) password can now be stored into the database. By using an CustomMembeship-Provider you do not have to miss the WebSecurity-Method the Asp.Net-Framework provides to you.</p>

<p>While verifying the User <code class="highlighter-rouge">VerifyHashedPassword(...)</code> returns a bool wether the given plain-text password the user gave to you during the login-process salted with the PasswordSalt generated during login compares corectly or not.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="kt">bool</span> <span class="nf">ValidateUser</span><span class="p">(</span><span class="kt">string</span> <span class="n">username</span><span class="p">,</span> <span class="kt">string</span> <span class="n">password</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">DataBaseContext</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataBaseContext</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">User</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Username</span> <span class="p">==</span> <span class="n">username</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">Crypto</span><span class="p">.</span><span class="nf">VerifyHashedPassword</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">Password</span><span class="p">,</span> <span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"{0}{1}"</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">PasswordSalt</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>With this code you can store your password safely with saving a lot of work by wusing the .Net-provided Crypto-Namespace.</p>

<p>Fabian</p>

	  ]]></description>
	</item>


</channel>
</rss>
